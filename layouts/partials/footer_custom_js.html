{{- /* This file extends the PaperMod footer with ADA compliance enhancements */ -}}

{{- /* Enhanced ADA Compliant Theme Toggle */ -}}
{{- if (not site.Params.disableThemeToggle) }}
<script>
/* ADA Compliant Theme Toggle Enhancement */
document.addEventListener('DOMContentLoaded', function() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;

    // Create screen reader announcement area
    const srOnly = document.createElement('div');
    srOnly.setAttribute('aria-live', 'polite');
    srOnly.setAttribute('aria-atomic', 'true');
    srOnly.className = 'sr-only';
    srOnly.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;';
    document.body.appendChild(srOnly);

    // Function to update ARIA attributes and announce changes
    function updateThemeState(isDark) {
        const currentTheme = isDark ? 'dark' : 'light';
        const oppositeTheme = isDark ? 'light' : 'dark';
        
        // Update ARIA attributes
        themeToggle.setAttribute('aria-pressed', isDark.toString());
        themeToggle.setAttribute('aria-label', 'Switch to ' + oppositeTheme + ' theme. Current theme: ' + currentTheme);
        themeToggle.title = 'Switch to ' + oppositeTheme + ' theme (Alt + T)';
        
        // Announce change to screen readers
        srOnly.textContent = 'Switched to ' + currentTheme + ' theme';
        
        // Clear announcement after screen readers have had time to read it
        setTimeout(function() {
            srOnly.textContent = '';
        }, 1000);
    }

    // Initialize ARIA state based on current theme
    const isDarkMode = document.body.className.includes('dark');
    updateThemeState(isDarkMode);

    // Enhanced click handler - work with original theme toggle
    const originalToggle = themeToggle.cloneNode(true);
    themeToggle.parentNode.replaceChild(originalToggle, themeToggle);
    
    originalToggle.addEventListener('click', function(e) {
        const wasDark = document.body.className.includes('dark');
        
        // Execute original theme toggle logic
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
        
        // Update accessibility attributes
        setTimeout(function() {
            updateThemeState(!wasDark);
        }, 10);
    });

    // Enhanced keyboard support
    originalToggle.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            originalToggle.click();
        }
    });
});
</script>
{{- end }}

{{- /* ADA Compliant Back-to-Top Button Enhancement */ -}}
<script>
/* ADA Compliant Back-to-Top Button Enhancement */
document.addEventListener('DOMContentLoaded', function() {
    const topLink = document.getElementById('top-link');
    if (!topLink) return;

    // Function to manage tabindex based on visibility
    function updateTopLinkAccessibility() {
        const isVisible = topLink.style.visibility === 'visible' || 
                         topLink.classList.contains('show') ||
                         getComputedStyle(topLink).visibility === 'visible';
        
        if (isVisible) {
            // Make focusable when visible
            topLink.setAttribute('tabindex', '0');
            topLink.setAttribute('aria-hidden', 'false');
        } else {
            // Remove from tab order when hidden
            topLink.setAttribute('tabindex', '-1');
            topLink.setAttribute('aria-hidden', 'true');
        }
    }

    // Enhanced ARIA attributes
    topLink.setAttribute('role', 'button');
    topLink.setAttribute('aria-label', 'Go back to top of page');
    
    // Initialize accessibility state
    updateTopLinkAccessibility();

    // Monitor visibility changes using MutationObserver
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && 
                (mutation.attributeName === 'style' || mutation.attributeName === 'class')) {
                updateTopLinkAccessibility();
            }
        });
    });

    // Start observing
    observer.observe(topLink, {
        attributes: true,
        attributeFilter: ['style', 'class']
    });

    // Also monitor style changes that might not trigger mutations
    const checkVisibility = setInterval(function() {
        updateTopLinkAccessibility();
    }, 1000);

    // Enhanced keyboard support
    topLink.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            
            // Smooth scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
            
            // Focus the top of the page for screen readers
            const topElement = document.getElementById('top') || document.body;
            if (topElement) {
                topElement.focus();
            }
        }
    });

    // Enhanced click handler
    topLink.addEventListener('click', function(e) {
        // Let the original handler work, but add smooth scrolling
        e.preventDefault();
        
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
        
        // Focus management for accessibility
        const topElement = document.getElementById('top') || document.body;
        if (topElement) {
            topElement.setAttribute('tabindex', '-1');
            topElement.focus();
        }
    });

    // Clean up on page unload
    window.addEventListener('beforeunload', function() {
        observer.disconnect();
        clearInterval(checkVisibility);
    });
});
</script>
