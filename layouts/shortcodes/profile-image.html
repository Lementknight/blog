{{/* Profile Image Shortcode with optimized processing */}}
{{- $image := resources.Get (.Get "src") -}}
{{- $alt := .Get "alt" | default "Profile image" -}}
{{- $width := .Get "width" | default 300 -}}
{{- $height := .Get "height" | default 300 -}}

{{- if $image -}}
  {{/* Create multiple sizes for responsive loading */}}
  {{- $small := $image.Resize (printf "%dx%d q95 lanczos" (mul $width 1) (mul $height 1)) -}}
  {{- $medium := $image.Resize (printf "%dx%d q95 lanczos" (mul $width 2) (mul $height 2)) -}}
  
  {{/* Generate WebP versions for modern browsers */}}
  {{- $smallWebp := $small.Process "webp q95" -}}
  {{- $mediumWebp := $medium.Process "webp q95" -}}
  
  <picture class="profile-image">
    {{/* WebP sources for modern browsers */}}
    <source srcset="{{ $smallWebp.RelPermalink }} 1x, {{ $mediumWebp.RelPermalink }} 2x" type="image/webp">
    {{/* Fallback JPEG sources */}}
    <source srcset="{{ $small.RelPermalink }} 1x, {{ $medium.RelPermalink }} 2x" type="image/jpeg">
    {{/* Fallback img tag */}}
    <img 
      src="{{ $small.RelPermalink }}" 
      alt="{{ $alt }}"
      width="{{ $width }}"
      height="{{ $height }}"
      loading="eager"
      decoding="async"
      style="border-radius: 50%; object-fit: cover;"
    >
  </picture>
{{- else -}}
  {{/* Fallback if image not found */}}
  <div class="profile-image-placeholder" style="width: {{ $width }}px; height: {{ $height }}px; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
    <span>{{ $alt }}</span>
  </div>
{{- end -}}
